(this.webpackJsonp=this.webpackJsonp||[]).push([["klaviyo-integration-plugin"],{"3FV1":function(t){t.exports=JSON.parse('{"klaviyo_integration_plugin":{"not_available":"N/A","subscribers":{"last_synchronization_status":{"finished":"Last Synchronization: {status} ({date})","not_finished":"Last Synchronization: {status}"},"last_success_synchronization":"Last Success Synchronization: {date}","get_synchronization_status":{"failed":"Failed to get Last Subscribers synchronization status"},"schedule_synchronization":{"button_label":"Synchronize subscribers","success":"Subscribers synchronization scheduled","failed":"Subscribers synchronization failed to schedule","is_running":"Subscribers synchronization is already running"}},"historical_events_tracking":{"last_synchronization_status":{"finished":"Last Synchronization: {status} ({date})","not_finished":"Last Synchronization: {status}"},"last_success_synchronization":"Last Success Synchronization: {date}","get_synchronization_status":{"failed":"Failed to get Last Historical Events Tracking synchronization status"},"schedule_synchronization":{"button_label":"Synchronize historical events","success":"Historical events tracking synchronization scheduled","failed":"Historical events tracking synchronization failed to schedule","is_running":"Historical events tracking synchronization is already running"}},"promotion":{"exportInKlaviyoFormatButtonLabel":"Export in Klaviyo Format"},"productComparison":{"templates":{"template-label":{"klaviyo-product-feed":"Klaviyo (XML)"}}}}}')},"EU/g":function(t,n){t.exports="</Products>\n</rss>\n"},UrNF:function(t,n,i){},cmNQ:function(t,n,i){"use strict";i.r(n);var e=i("pIgR"),o=i.n(e);Shopware.Component.override("sw-system-config",{template:o.a});var s=i("3FV1"),a=i("jumV"),r=i.n(a);i("ka2J");function c(t,n){for(var i=0;i<n.length;i++){var e=n[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var l=function(){function t(n,i){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.apiService=n,this.lastSuccessJob=null,this.lastJob=null,this.lastSynchronizationStatus="",this.lastSynchronizationDate="",this.lastSuccessSynchronizationDate="",this.isSynchronizationInProgress=!1,this.isSynchronizationSuccess=!1,this.date=i}var n,i,e;return n=t,(i=[{key:"updateJobStatuses",value:function(){var t=this,n=this.apiService.getJobStatus();return n.then((function(n){n.data.lastSuccessJob?t.lastSuccessJob=n.data.lastSuccessJob:t.lastSuccessJob=null,n.data.lastJob?t.lastJob=n.data.lastJob:t.lastJob=null,t.updateLastSynchronizationStatus(),t.updateLastSuccessSynchronizationDate()})).catch((function(t){console.error("Failed to get job status",t)})),n}},{key:"updateLastSynchronizationStatus",value:function(){this.lastJob?(this.lastSynchronizationStatus=this.lastJob.status,this.lastJob.finishedAt?this.lastSynchronizationDate=this.date(this.lastJob.finishedAt,{hour:"2-digit",minute:"2-digit"}):this.lastSynchronizationDate=null):(this.lastSynchronizationStatus=null,this.lastSynchronizationDate=null)}},{key:"updateLastSuccessSynchronizationDate",value:function(){this.lastSuccessJob&&this.lastSuccessJob.finishedAt?this.lastSuccessSynchronizationDate=this.date(this.lastSuccessJob.finishedAt,{hour:"2-digit",minute:"2-digit"}):this.lastSuccessSynchronizationDate=null}},{key:"scheduleSynchronization",value:function(){var t=this.apiService.scheduleSynchronization();return this.isSynchronizationInProgress=!0,t.then(function(t){this.isSynchronizationSuccess=!!t.data.isScheduled}.bind(this)).catch(function(t){this.isSynchronizationSuccess=!1}.bind(this)).finally(function(){this.isSynchronizationInProgress=!1}.bind(this)),t}},{key:"resetSynchronizationState",value:function(){this.isSynchronizationInProgress=!1,this.isSynchronizationSuccess=!1}}])&&c(n.prototype,i),e&&c(n,e),t}(),u=Shopware,h=u.Component,y=u.Mixin,p=Shopware.Utils.format.date;h.register("klaviyo-historical-events-synchronization-control",{template:r.a,inject:["klaviyoHistoricalEventsSynchronizationApiService","klaviyoSubscribersSynchronizationApiService"],snippets:{"en-GB":s},mixins:[y.getByName("notification")],data:function(){return{historicalEventsJobInteractor:new l(this.klaviyoHistoricalEventsSynchronizationApiService,p),subscribersSynchronizationJobInteractor:new l(this.klaviyoSubscribersSynchronizationApiService,p)}},created:function(){this.createdComponent()},computed:{scheduleHistoricalEventsSynchronizationTooltip:function(){return this.getSynchronizationTooltipOptions(this.historicalEventsJobInteractor,"klaviyo_integration_plugin.historical_events_tracking.last_synchronization_status","klaviyo_integration_plugin.historical_events_tracking.last_success_synchronization")},scheduleSubscribersSynchronizationTooltip:function(){return this.getSynchronizationTooltipOptions(this.subscribersSynchronizationJobInteractor,"klaviyo_integration_plugin.subscribers.last_synchronization_status","klaviyo_integration_plugin.subscribers.last_success_synchronization")}},methods:{createdComponent:function(){this.updateJobStatuses()},updateJobStatuses:function(){this.updateHistoricalEventJobStatus(),this.updateSubscribersSyncJobStatus()},updateHistoricalEventJobStatus:function(){var t=this;this.historicalEventsJobInteractor.updateJobStatuses().catch((function(){t.createNotificationError({message:t.$tc("klaviyo_integration_plugin.historical_events_tracking.get_synchronization_status.failed")})}))},updateSubscribersSyncJobStatus:function(){var t=this;this.subscribersSynchronizationJobInteractor.updateJobStatuses().catch((function(){t.createNotificationError({message:t.$tc("klaviyo_integration_plugin.schedule_synchronization.get_synchronization_status.failed")})}))},scheduleHistoricalEventsSynchronization:function(){this.historicalEventsJobInteractor.scheduleSynchronization().then(function(t){t.data.isScheduled?this.createNotificationSuccess({message:this.$tc("klaviyo_integration_plugin.historical_events_tracking.schedule_synchronization.success")}):"SYNCHRONIZATION_IS_ALREADY_RUNNING"===t.data.errorCode?this.createNotificationWarning({message:this.$tc("klaviyo_integration_plugin.historical_events_tracking.schedule_synchronization.is_running")}):this.createNotificationWarning({message:this.$tc("klaviyo_integration_plugin.historical_events_tracking.schedule_synchronization.failed")})}.bind(this)).catch(function(t){this.createNotificationError({message:this.$tc("klaviyo_integration_plugin.historical_events_tracking.schedule_synchronization.failed")})}.bind(this))},scheduleSubscribersSynchronization:function(){this.subscribersSynchronizationJobInteractor.scheduleSynchronization().then(function(t){t.data.isScheduled?this.createNotificationSuccess({message:this.$tc("klaviyo_integration_plugin.subscribers.schedule_synchronization.success")}):"SYNCHRONIZATION_IS_ALREADY_RUNNING"===t.data.errorCode?this.createNotificationWarning({message:this.$tc("klaviyo_integration_plugin.subscribers.schedule_synchronization.is_running")}):this.createNotificationWarning({message:this.$tc("klaviyo_integration_plugin.subscribers.schedule_synchronization.failed")})}.bind(this)).catch(function(){this.createNotificationError({message:this.$tc("klaviyo_integration_plugin.subscribers.schedule_synchronization.failed")})}.bind(this))},resetSubscribersSynchronizationState:function(){this.subscribersSynchronizationJobInteractor.resetSynchronizationState()},resetHistoricalEventsSynchronizationState:function(){this.historicalEventsJobInteractor.resetSynchronizationState()},getSynchronizationTooltipOptions:function(t,n,i){var e=this.$tc("klaviyo_integration_plugin.not_available");if(!t||!t.lastJob)return{disabled:!0,message:e,width:200};var o=t.lastSynchronizationStatus?t.lastSynchronizationStatus:e,s=t.lastSynchronizationDate?this.$tc(n+".finished",0,{status:o,date:t.lastSynchronizationDate}):this.$tc(n+".not_finished",0,{status:o}),a=t.lastSuccessSynchronizationDate?t.lastSuccessSynchronizationDate:e;return{disabled:!1,message:s+"<br/>"+this.$tc(i,0,{date:a}),width:320}}}});var d=i("fzkF"),S=i.n(d);function b(t,n){for(var i=0;i<n.length;i++){var e=n[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}Shopware.Component.override("sw-promotion-v2-list",{template:S.a,methods:{getExportUrl:function(){return Shopware.Context.api.apiPath+"/klaviyo/integration/promotion/export"}}});var v=function(){function t(n,i){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.httpClient=n,this.loginService=i,this.name="klaviyoHistoricalEventsSynchronizationApiService"}var n,i,e;return n=t,(i=[{key:"getJobStatus",value:function(){var t=this.getHeaders();return this.httpClient.get("/klaviyo/integration/job/_action/historical-event-tracking/synchronization/get_status",{},{headers:t})}},{key:"scheduleSynchronization",value:function(){var t=this.getHeaders();return this.httpClient.post("/klaviyo/integration/job/_action/historical-event-tracking/synchronization/schedule",{},{headers:t})}},{key:"getHeaders",value:function(){return{Accept:"application/json",Authorization:"Bearer ".concat(this.loginService.getToken()),"Content-Type":"application/json"}}}])&&b(n.prototype,i),e&&b(n,e),t}();function g(t,n){for(var i=0;i<n.length;i++){var e=n[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var _=function(){function t(n,i){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.httpClient=n,this.loginService=i,this.name="klaviyoSubscribersSynchronizationApiService"}var n,i,e;return n=t,(i=[{key:"getJobStatus",value:function(){var t=this.getHeaders();return this.httpClient.get("/klaviyo/integration/job/_action/subscribers/synchronization/get_status",{},{headers:t})}},{key:"scheduleSynchronization",value:function(){var t=this.getHeaders();return this.httpClient.post("/klaviyo/integration/job/_action/subscribers/synchronization/schedule",{},{headers:t})}},{key:"getHeaders",value:function(){return{Accept:"application/json",Authorization:"Bearer ".concat(this.loginService.getToken()),"Content-Type":"application/json"}}}])&&g(n.prototype,i),e&&g(n,e),t}();Shopware.Service().register("klaviyoHistoricalEventsSynchronizationApiService",(function(t){var n=Shopware.Application.getContainer("init");return new v(n.httpClient,t.loginService)})),Shopware.Service().register("klaviyoSubscribersSynchronizationApiService",(function(t){var n=Shopware.Application.getContainer("init");return new _(n.httpClient,t.loginService)}));var f=i("pJGq"),z=i.n(f),k=i("rZjl"),m=i.n(k),w=i("EU/g"),J=i.n(w);Shopware.Service("exportTemplateService").registerProductExportTemplate({name:"klaviyo-product-feed",translationKey:"klaviyo_integration_plugin.productComparison.templates.template-label.klaviyo-product-feed",headerTemplate:z.a.trim(),bodyTemplate:m.a,footerTemplate:J.a.trim(),fileName:"klaviyo.xml",encoding:"UTF-8",fileFormat:"xml",generateByCronjob:!1,interval:86400})},fzkF:function(t,n){t.exports='{% block sw_promotion_v2_list_smart_bar_actions_add %}\n    {% parent %}\n    <sw-button\n            :link="getExportUrl()"\n            variant="primary"\n    >\n        {{ $tc(\'klaviyo_integration_plugin.promotion.exportInKlaviyoFormatButtonLabel\') }}\n    </sw-button>\n{% endblock %}\n\n{% parent %}'},jumV:function(t,n){t.exports='<div class="klaviyo-historical-events-synchronization-control-wrapper">\n    <sw-card hero="true">\n        <sw-container columns="1fr 1fr">\n            <sw-card-section>\n                <sw-button-process variant="ghost"\n                                   :isLoading="historicalEventsJobInteractor.isSynchronizationInProgress"\n                                   :processSuccess="historicalEventsJobInteractor.isSynchronizationSuccess"\n                                   @click="scheduleHistoricalEventsSynchronization"\n                                   @process-finish="resetHistoricalEventsSynchronizationState"\n                                   v-tooltip="scheduleHistoricalEventsSynchronizationTooltip"\n                >\n                    {{ $tc(\'klaviyo_integration_plugin.historical_events_tracking.schedule_synchronization.button_label\') }}\n                </sw-button-process>\n            </sw-card-section>\n            <sw-card-section>\n                <sw-button-process variant="ghost"\n                                   :isLoading="subscribersSynchronizationJobInteractor.isSynchronizationInProgress"\n                                   :processSuccess="subscribersSynchronizationJobInteractor.isSynchronizationSuccess"\n                                   @click="scheduleSubscribersSynchronization"\n                                   @process-finish="resetSubscribersSynchronizationState"\n                                   v-tooltip="scheduleSubscribersSynchronizationTooltip"\n                >\n                    {{ $tc(\'klaviyo_integration_plugin.subscribers.schedule_synchronization.button_label\') }}\n                </sw-button-process>\n            </sw-card-section>\n        </sw-container>\n    </sw-card>\n</div>'},ka2J:function(t,n,i){var e=i("UrNF");"string"==typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);(0,i("SZ7m").default)("ae81479a",e,!0,{})},pIgR:function(t,n){t.exports="{% block sw_system_config_content_card %}\n    <klaviyo-historical-events-synchronization-control v-if=\"domain==='KlaviyoIntegrationPlugin.config'\">\n    </klaviyo-historical-events-synchronization-control>\n    {% parent %}\n{% endblock %}\n\n{% parent %}\n"},pJGq:function(t,n){t.exports='<?xml version="1.0" encoding="UTF-8" ?>\n<rss version="2.0" xmlns:g="http://base.google.com/ns/1.0" xmlns:atom="http://www.w3.org/2005/Atom">\n    <Products>\n'},rZjl:function(t,n){t.exports="<Product>\n    <id>{{ product.productNumber }}</id>\n    <title>{{ product.translated.name|escape }}</title>\n    <link>{{ seoUrl('frontend.detail.page', {'productId': product.id}) }}</link>\n    <description>{{ product.translated.description|escape }}</description>\n    <price>{% set price = product.calculatedPrice %} {% if product.calculatedPrices.count %} {% set price = product.calculatedPrices.last %} {% endif %} {{ price.unitPrice }}</price>\n    <image_link>{{ product.cover.media.url }}</image_link>\n    <categories>{{ product.categories.first.getBreadCrumb|slice(1)|join(' > ')|raw|escape }}</categories>\n    <inventory_quantity>{{ product.availableStock }}</inventory_quantity>\n    <inventory_policy>1</inventory_policy>\n</Product>\n"}},[["cmNQ","runtime","vendors-node"]]]);